#!/usr/bin/env python
# -*- coding: utf-8 -*-

# Copyright (C) 2015, CERN
# This software is distributed under the terms of the GNU General Public
# Licence version 3 (GPL Version 3), copied verbatim in the file "LICENSE".
# In applying this license, CERN does not waive the privileges and immunities
# granted to it by virtue of its status as Intergovernmental Organization
# or submit itself to any jurisdiction.

"""
DB On Demand metadata REST API server
"""

import ConfigParser
import sys, traceback
from dbod_metadata.views import APP
import ssl

try:
    # Loads configuration
    config = ConfigParser.ConfigParser()
    config.read('/etc/dbod/metadata.cfg')
    hostcert = config.get('ssl', 'hostcert')
    hostkey = config.get('ssl', 'hostkey')
except IOError as e:
    traceback.print_exc(file=sys.stdout)
    sys.exit(e.code)
except ConfigParser.NoOptionError:
    traceback.print_exc(file=sys.stdout)
    sys.exit(1)

def main():
    """ Main body """
    context = ssl.SSLContext(ssl.PROTOCOL_TLSv1_2)
    context.load_cert_chain(hostcert, hostkey)

    APP.run(host='127.0.0.1', port=6666, debug=True, ssl_context=context)


if __name__ == "__main__":
    main()
